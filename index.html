<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>USEPA EJ Grants Under IRA</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.32/"></script>
    
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      /* #seasons-filter {
        height: 200px;
        width: 100%;
        visibility: hidden;
      }

      .season-item {
        width: 100%;
        padding: 12px;
        text-align: center;
        vertical-align: baseline;
        cursor: pointer;
        height: 40px;
      }

      .season-item:focus {
        background-color: dimgrey;
      }

      .season-item:hover {
        background-color: dimgrey;
      } */

      .test{
        height: 90vh;
      }
    </style>
    <script>
      require([
        "esri/views/MapView",
        "esri/Map",
        "esri/layers/FeatureLayer",
        "esri/widgets/Expand",
        "esri/core/reactiveUtils",
        "esri/widgets/Search"
      ], (MapView, Map, FeatureLayer, Expand, reactiveUtils, Search) => {
        let floodLayerView;

        // flash flood warnings layer
        const layer = new FeatureLayer({
          portalItem: {
            id: "6ec4f16b6f334cedab28bb7c585ff410"
          },
          outFields: ["*"],
         
        });

        const map = new Map({
          layers: [layer],
          basemap: "gray-vector",
        });

        const view = new MapView({
          map: map,
          container: "viewDiv",
          center: [-98, 40],
          zoom: 4
        });

        const searchWidget = new Search({
            view: view,
            popupEnabled: false,
        });
        // Adds the search widget below other elements in
        // the top left corner of the view
        view.ui.add(searchWidget, {
            position: "top-left",
            index: 0
        });

        //const seasonsNodes = document.querySelectorAll(`.season-item`);
        const seasonsElement = document.getElementById("seasons-filter");

        // click event handler for seasons choices
        seasonsElement.addEventListener("click", filterBySeason);

        // User clicked on Winter, Spring, Summer or Fall
        // set an attribute filter on flood warnings layer view
        // to display the warnings issued in that season
        function filterBySeason(event) {
          console.log(event)
          const selectedSeason = event.target.getAttribute("data-season");
          console.log(selectedSeason)
          if (selectedSeason == "All EJ Grants"){
            floodLayerView.filter = null;
          } else {
            floodLayerView.filter = {
            where: " Program = '" + selectedSeason + "'"
          };
          }
          
        }

        view.whenLayerView(layer).then((layerView) => { 
          // flash flood warnings layer loaded
          // get a reference to the flood warnings layerview
          floodLayerView = layerView;

          // set up UI items
          /*
          seasonsElement.style.visibility = "visible";
          const seasonsExpand = new Expand({
            view: view,
            content: seasonsElement,
            expandIcon: "filter",
            group: "top-left"
          });
          //clear the filters when user closes the expand widget
          reactiveUtils.when(
            () => !seasonsExpand.expanded,
            () => {
              floodLayerView.filter = null;
            }
          );
          view.ui.add(seasonsExpand, "top-left");
          view.ui.add("titleDiv", "top-right");
          */
        }); 
      });
    </script>
  </head>

  <body>
    <!-- <div id="seasons-filter" class="esri-widget">
      <div class="season-item visible-season" data-season="Environmental Justice Collaborative Problem Solving">Collaborative Problem Solving</div>
      <div class="season-item visible-season" data-season="Environmental Justice Community Change Grants">Community Change Grants</div>
      <div class="season-item visible-season" data-season="Environmental Justice Government-to-Government">Government-to-Government</div>
      <div class="season-item visible-season" data-season="Fenceline Monitoring">Fenceline Monitoring</div>
      <div class="season-item visible-season" data-season="Environmental Justice Collaborative Problem-Solving Cooperative Agreement Program"> Collaborative Problem-Solving Cooperative Agreement Program</div>
      
    </div> -->
    
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8 test">
                <div id="viewDiv"></div>
            </div>
            <div class="col-md-4">
                <h1 class="display-6">USEPA EJ Grants</h1>
                <p class="lead">Made under IRA</p>


                <div class="btn-group-vertical" id="seasons-filter" role="group" aria-label="Vertical radio toggle button group">
                    <input type="radio" class="btn-check" name="vbtn-radio" id="vbtn-radio1" 
                    data-season="All EJ Grants" autocomplete="off" checked>
                    <label class="btn btn-secondary" for="vbtn-radio1">All EJ Grants</label>
                    
                    <input type="radio" class="btn-check" name="vbtn-radio" id="vbtn-radio2" 
                    data-season="Environmental Justice Collaborative Problem Solving" autocomplete="off">
                    <label class="btn btn-secondary" for="vbtn-radio2">Collaborative Problem Solving</label>

                    <input type="radio" class="btn-check" name="vbtn-radio" id="vbtn-radio3" 
                    data-season="Environmental Justice Collaborative Problem-Solving Cooperative Agreement Program" autocomplete="off">
                    <label class="btn btn-secondary" for="vbtn-radio3">Collaborative Problem Solving Cooperative Agreement Program</label>
                    
                    <input type="radio" class="btn-check" name="vbtn-radio" id="vbtn-radio4" 
                    data-season="Environmental Justice Community Change Grants" autocomplete="off">
                    <label class="btn btn-secondary" for="vbtn-radio4">Community Change Grants</label>

                    <input type="radio" class="btn-check" name="vbtn-radio" id="vbtn-radio5" 
                    data-season="Environmental Justice Government-to-Government" autocomplete="off">
                    <label class="btn btn-secondary" for="vbtn-radio5">Government-to-Government</label>

                    <input type="radio" class="btn-check" name="vbtn-radio" id="vbtn-radio6" 
                    data-season="Fenceline Monitoring" autocomplete="off">
                    <label class="btn btn-secondary" for="vbtn-radio6">Fenceline Monitoring</label>
                    
                </div>

                <div>
                    <br><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        About the Data
                    </button>
                </div>
                
                
                <div class="modal" id="exampleModal" tabindex="-1">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title">About the Data</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <p>These data depict the primary place of performance only for select EPA projects and highlights a subset of all investments made under the Bipartisan Infrastructure Law and the Inflation Reduction Act. Both primary and sub-award information is included; however, funding amounts are not displayed for sub-awards / projects. Locations indicated here are determined using a variety of methods and may not correspond precisely to an exact, physical location. This map is not comprehensive and will be updated periodically as additional information becomes available including sub-award grant data. 
        
                            <h6>Data Caveats</h6>
                            <ol type="1">
                                <li>
                                    The points on the map are an approximation of the place of performance and do not represent the full extent of where, e.g., clean school buses will be operating and where emissions benefits from these projects will accrue.  In fact, in accordance with OMB reporting requirements, grants which are associated with multiple places of performance are represented in this map by the primary place of performance as indicated by the EPA grant project officer.
                                </li>
                                <li>
                                    This data visualization does not include information about regularly appropriated EPA program dollars, only EPA Bipartisan Infrastructure Law and Inflation Reduction Act funding.
                                </li>
                                <li>
                                    In the case of EPA’s Office of Air & Radiation grants, it is important to note cases where the dot on the map is just an approximation: (a) Where one grant is funding the purchase of multiple vehicles, operating in multiple locations, the one dot must represent dozens of actual places of performance. For example, under the Clean School Bus program, if a third-party applicant includes 10 school districts, each funding 2 buses, the dot associated with that participant may actually represent ten distinct places of performance. (b) Similarly, for the Diesel Emissions Reduction Act (DERA), a single grant, represented by a single dot on the map could fund one crane at an airport and five heavy-duty buses, each operating in multiple counties.  (c) Additionally, the dot on the map sometimes represents the address of the grantee instead of the place of performance or where the vehicles will be operating. ﻿
                                </li>
                            </ol>        
                            <h6>Data Source Information</h6>
                            Apart from a few programs, these data are updated daily in accordance with new award information entered into EPA's NextGen Grants Systems (NGGS). Superfund, Clean School Bus, and a few other programs have their data sourced directly from the programs on a less than daily basis. Reach out to dmap@epa.gov with questions about the API.
        
                            <p><br>With regards to point feature placement on the map, the NGGS system offers a robust interface allowing the project officer to map the place of performance by political boundary or natural feature (such as watershed). If a grant is having benefit over multiple places of performance, a project officer must choose a primary one and for that one the centroid is used to place the point on the map. In some cases, this centroid is a fair approximation of the place of benefit but in other cases, such as with grants addressing air quality, it can largely under-represent the actual benefited areas. For general questions about the application reach out to enviromail_group@epa.gov. 
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                  </div>
            </div>
        </div>
    </div>
  </body>
</html>

